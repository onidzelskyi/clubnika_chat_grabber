X-Account-Key: account5
X-UIDL: GmailId127d40a6179ea34c
X-Mozilla-Status: 0000
X-Mozilla-Status2: 00000000
X-Mozilla-Keys:                                                                                 
Delivered-To: mlsubscriber.tech@csmining.org
Received: by 10.142.71.20 with SMTP id t20cs202159wfa;
        Tue, 6 Apr 2010 09:53:23 -0700 (PDT)
Received: by 10.223.143.12 with SMTP id s12mr7773751fau.9.1270572802368;
        Tue, 06 Apr 2010 09:53:22 -0700 (PDT)
Return-Path: <bounce-debian-user=mlsubscriber.tech=csmining.org@lists.debian.org>
Received: from liszt.debian.org (liszt.debian.org [82.195.75.100])
        by mx.google.com with ESMTP id 24si11669376fxm.73.2010.04.06.09.53.21;
        Tue, 06 Apr 2010 09:53:22 -0700 (PDT)
Received-SPF: pass (google.com: manual fallback record for domain of bounce-debian-user=mlsubscriber.tech=csmining.org@lists.debian.org designates 82.195.75.100 as permitted sender) client-ip=82.195.75.100;
Authentication-Results: mx.google.com; spf=pass (google.com: manual fallback record for domain of bounce-debian-user=mlsubscriber.tech=csmining.org@lists.debian.org designates 82.195.75.100 as permitted sender) smtp.mail=bounce-debian-user=mlsubscriber.tech=csmining.org@lists.debian.org; dkim=neutral (body hash did not verify) header.i=@csmining.org
Received: from localhost (localhost [127.0.0.1])
	by liszt.debian.org (Postfix) with QMQP
	id 0B35D2D1057; Tue,  6 Apr 2010 16:53:11 +0000 (UTC)
Old-Return-Path: <axton.grams@csmining.org>
XChecker-Version: SpamAssassin 3.2.5 (2008-06-10) on liszt.debian.org
XLevel: 
XStatus: No, score=-4.2 required=4.0 tests=FOURLA,GMAIL,HTML_MESSAGE,
	IMPRONONCABLE_1,IMPRONONCABLE_2,LDOSUBSCRIBER,LDO_WHITELIST,
	MURPHY_WRONG_WORD2,PHONENUMBER,SARE_MSGID_LONG45 autolearn=failed
	version=3.2.5
X-Original-To: lists-debian-user@liszt.debian.org
Delivered-To: lists-debian-user@liszt.debian.org
Received: from localhost (localhost [127.0.0.1])
	by liszt.debian.org (Postfix) with ESMTP id BA2E02D1052
	for <lists-debian-user@liszt.debian.org>; Tue,  6 Apr 2010 16:53:04 +0000 (UTC)
X-Virus-Scanned: at lists.debian.org with policy bank en-ht
X-AmavisStatus: No, score=-0.307 tagged_above=-10000 required=5.3
	tests=[BAYES_00=-2, FOURLA=0.1, GMAIL=1, HTML_MESSAGE=1,
	IMPRONONCABLE_1=1, IMPRONONCABLE_2=1, LDO_WHITELIST=-5,
	MURPHY_WRONG_WORD2=0.2, PHONENUMBER=1.5, SARE_MSGID_LONG45=0.893]
	autolearn=no
Received: from liszt.debian.org ([127.0.0.1])
	by localhost (lists.debian.org [127.0.0.1]) (amavisd-new, port 2525)
	with ESMTP id yUulg9J0VlCh for <lists-debian-user@liszt.debian.org>;
	Tue,  6 Apr 2010 16:52:55 +0000 (UTC)
X-policyd-weight: using cached result; rate:hard: -6.9
Received: from mail-yw0-f197.google.com (mail-yw0-f197.google.com [209.85.211.197])
	by liszt.debian.org (Postfix) with ESMTP id 44E2F2D104E
	for <debian-user@lists.debian.org>; Tue,  6 Apr 2010 16:52:55 +0000 (UTC)
Received: by ywh35 with SMTP id 35so37939ywh.24
        for <debian-user@lists.debian.org>; Tue, 06 Apr 2010 09:52:48 -0700 (PDT)
DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed;
        d=csmining.org; s=gamma;
        h=domainkey-signature:mime-version:received:in-reply-to:references
         :date:received:message-id:subject:from:to:content-type;
        bh=WxKsJ0W+kD3lVosLmbDpkZak0kECtDX06PRXkYp86sw=;
        b=CrakK2mhHpoNPnnRaE6SXVQdSKzv8gFX1wJxMCxNK9EoYlac0389DcPc3BeUGKUuKK
         xhB5EHfLFPcZf4R3/yVhnTLIbW0goUSeFswJ3OnFveTyxiQjprQ9CeljlxrSFIVvRHIA
         xpPnRdsEu0vWQ6zP919L1B4207ACWWP1cOfRk=
DomainKey-Signature: a=rsa-sha1; c=nofws;
        d=csmining.org; s=gamma;
        h=mime-version:in-reply-to:references:date:message-id:subject:from:to
         :content-type;
        b=HRVmmdUN7v46YO3oFXaxjwGgk0omjg2aB+FLWK0uppbA+yAj35R+EMADD06/nauEuA
         6phIkwWEdvrW0U380VyOa7BtHx3wfUbHO9mesMPZFzsC+c3WwgF6uQBF+xlOYEbeGQ5T
         1JXiBPW8OtCPGwRv5fuTq4Wi02DqghYmzCKy4=
MIME-Version: 1.0
Received: by 10.150.202.9 with HTTP; Tue, 6 Apr 2010 09:52:47 -0700 (PDT)
In-Reply-To: <h2vf5c17fbb1004041535i498e3d8emee59f4161ac6f783@mail.csmining.org>
References: <h2vf5c17fbb1004041535i498e3d8emee59f4161ac6f783@mail.csmining.org>
Date: Tue, 6 Apr 2010 11:52:47 -0500
Received: by 10.150.48.6 with SMTP id v6mr8690341ybv.39.1270572767934; Tue, 06 
	Apr 2010 09:52:47 -0700 (PDT)
Message-ID: <z2qf5c17fbb1004060952td1afc498ud1b9a402a955d1be@mail.csmining.org>
Subject: Re: interfaces - proper configuration
From: Axton <axton.grams@csmining.org>
To: debian-user@lists.debian.org
Content-Type: multipart/alternative; boundary=000e0cd709647e7a1304839446e4
X-Rc-Virus: 2007-09-13_01
X-Rc-Spam: 2008-11-04_01
Resent-Message-ID: <xfiXep2Y8NN.A.lwD.2b2uLB@liszt>
Resent-From: debian-user@lists.debian.org
X-Mailing-List: <debian-user@lists.debian.org> archive/latest/573451
X-Loop: debian-user@lists.debian.org
List-Id: <debian-user.lists.debian.org>
List-Post: <mailto:debian-user@lists.debian.org>
List-Help: <mailto:debian-user-request@lists.debian.org?subject=help>
List-Subscribe: <mailto:debian-user-request@lists.debian.org?subject=subscribe>
List-Unsubscribe: <mailto:debian-user-request@lists.debian.org?subject=unsubscribe>
Precedence: list
Resent-Sender: debian-user-request@lists.debian.org
Resent-Date: Tue,  6 Apr 2010 16:53:11 +0000 (UTC)

--000e0cd709647e7a1304839446e4
Content-Type: text/plain; charset=ISO-8859-1

No bites?

Axton

On Sun, Apr 4, 2010 at 5:35 PM, Axton <axton.grams@csmining.org> wrote:

> I am trying to set up the /etc/network/interfaces script properly so that
> all interfaces are started/stopped properly by /etc/init.d/networking.  I
> have this set up correctly, mostly, I think, but there is a flurry of
> warning messages on start of the /etc/init.d/networking.
>
> First, some background information on the setup.
>
> * Server is a Dell PowerEdge 2650 with 10gb physical memory (hence the i386
> bigmem kernel)
>
> * Running openvz kernel:
> agrams@dell2650-01:~$ uname -a
> Linux dell2650-01 2.6.26-2-openvz-686 #1 SMP Tue Mar 9 18:54:31 UTC 2010
> i686 GNU/Linux
>
> * Server has 2 nics:
> agrams@dell2650-01:~$ dmesg |egrep '(eth0|eth1)' |head -6
> [    5.050804] eth0: Tigon3 [partno(BCM95703A30) rev 1002 PHY(5703)]
> (PCIX:133MHz:64-bit) 10/100/1000Base-T Ethernet 00:11:43:32:68:ab
> [    5.050804] eth0: RXcsums[1] LinkChgREG[0] MIirq[0] ASF[0] WireSpeed[1]
> TSOcap[1]
> [    5.050804] eth0: dma_rwctrl[769c4000] dma_mask[64-bit]
> [    5.110547] eth1: Tigon3 [partno(BCM95703A30) rev 1002 PHY(5703)]
> (PCIX:133MHz:64-bit) 10/100/1000Base-T Ethernet 00:11:43:32:68:ac
> [    5.110553] eth1: RXcsums[1] LinkChgREG[0] MIirq[0] ASF[0] WireSpeed[1]
> TSOcap[1]
> [    5.110557] eth1: dma_rwctrl[769c4000] dma_mask[64-bit]
>
>
> Now, on to the network configuration:
>
> * Switch is a Dell PowerConnect 5324
> ** Server is connected to ports 13 and 15
> ** Link aggregation group is 1 with ports 13 and 15
>
> Here is the configuration from the switch console:
>
> dell5324# show interfaces status port-channel 1
>                                           Flow    Link
> Ch       Type    Duplex  Speed  Neg      control  State
> -------- ------- ------  -----  -------- -------  -----------
> ch1      1G      Full    1000   Enabled  Off      Up
>
> dell5324# show interfaces switchport port-channel 1
> Port : ch1
> Port Mode: General
> Gvrp Status: disabled
> Ingress Filtering: true
> Acceptable Frame Type: admitOnlyVlanTagged
> Ingress UnTagged VLAN ( NATIVE ): 4095
>
> Port is member in:
>
> Vlan               Name               Egress rule Port Membership Type
> ---- -------------------------------- ----------- --------------------
>  2                 LAN                  Tagged           Static
>  5                 DMZ                  Tagged           Static
>
> Forbidden VLANS:
>
> Vlan               Name
> ---- --------------------------------
>  3                 INET
>
> Classification rules:
>
> Protocol based VLANs:
>
> Group ID Vlan ID
> -------- -------
>
> dell5324# show interfaces port-channel 1
>
> Load balancing: Layer 3.
>
> Channel  Ports
> -------  -----
> ch1      Active: g(13,15)
>
> * I am setting up these interfaces as 802.3ad bonded interface (bond
> mode=4):
> agrams@dell2650-01:~$ cat /proc/net/bonding/bond0
> Ethernet Channel Bonding Driver: v3.2.5 (March 21, 2008)
>
> Bonding Mode: IEEE 802.3ad Dynamic link aggregation
> Transmit Hash Policy: layer3+4 (1)
> MII Status: up
> MII Polling Interval (ms): 100
> Up Delay (ms): 200
> Down Delay (ms): 200
>
> 802.3ad info
> LACP rate: fast
> Active Aggregator Info:
>         Aggregator ID: 10
>         Number of ports: 2
>         Actor Key: 17
>         Partner Key: 25
>         Partner Mac Address: 00:18:8b:97:47:00
>
> Slave Interface: eth0
> MII Status: up
> Link Failure Count: 0
> Permanent HW addr: 00:11:43:32:68:ab
> Aggregator ID: 10
>
> Slave Interface: eth1
> MII Status: up
> Link Failure Count: 0
> Permanent HW addr: 00:11:43:32:68:ac
> Aggregator ID: 10
>
> * On the Debian host, the following configuration in in place:
> agrams@dell2650-01:~$ cat /etc/network/interfaces
> # This file describes the network interfaces available on your system
> # and how to activate them. For more information, see interfaces(5).
>
> # The loopback network interface
> auto lo
> iface lo inet loopback
>
> # Physical interface 1
> auto eth0
> iface eth0 inet manual
>
> # Physical interface 2
> auto eth1
> iface eth1 inet manual
>
> # lacp bond interface
> auto bond0
> iface bond0 inet manual
>         up ifconfig bond0 0.0.0.0 up
>         slaves eth0 eth1
>
> # vlan2 bond interface
> auto bond0.2
> iface bond0.2 inet manual
>         up ifconfig bond0.2 0.0.0.0 up
>         pre-up /sbin/vconfig add bond0 2
>
> # bridge to vlan2 bond interface
> auto vlan2
> iface vlan2 inet dhcp
>         pre-up /usr/sbin/brctl addbr vlan2
>         pre-up /usr/sbin/brctl addif vlan2 bond0.2
>         pre-down /sbin/ifconfig vlan2 down
>         down /usr/sbin/brctl delif vlan2 bond0.2
>         post-down /usr/sbin/brctl delbr vlan2
>
> Which yields the following configuration information from the host:
>
> dell2650-01:~/media# cat /proc/net/bonding/bond0
> Ethernet Channel Bonding Driver: v3.2.5 (March 21, 2008)
>
> Bonding Mode: IEEE 802.3ad Dynamic link aggregation
> Transmit Hash Policy: layer3+4 (1)
> MII Status: up
> MII Polling Interval (ms): 100
> Up Delay (ms): 200
> Down Delay (ms): 200
>
> 802.3ad info
> LACP rate: fast
> Active Aggregator Info:
>         Aggregator ID: 10
>         Number of ports: 2
>         Actor Key: 17
>         Partner Key: 25
>         Partner Mac Address: 00:18:8b:97:47:00
>
> Slave Interface: eth0
> MII Status: up
> Link Failure Count: 0
> Permanent HW addr: 00:11:43:32:68:ab
> Aggregator ID: 10
>
> Slave Interface: eth1
> MII Status: up
> Link Failure Count: 0
> Permanent HW addr: 00:11:43:32:68:ac
> Aggregator ID: 10
>
> dell2650-01:~# cat /proc/net/vlan/config
> VLAN Dev name    | VLAN ID
> Name-Type: VLAN_NAME_TYPE_PLUS_VID_NO_PAD
> bond0.2        | 2  | bond0
>
> dell2650-01:~# cat /proc/net/vlan/bond0.2
> bond0.2  VID: 2  REORDER_HDR: 1  dev->priv_flags: 1
>          total frames received       189418
>           total bytes received    115871948
>       Broadcast/Multicast Rcvd       114195
>
>       total frames transmitted        56900
>        total bytes transmitted     10038649
>             total headroom inc            0
>            total encap on xmit            0
> Device: bond0
> INGRESS priority mappings: 0:0  1:0  2:0  3:0  4:0  5:0  6:0 7:0
> EGRESSS priority Mappings:
>
> dell2650-01:~/media# ifconfig -a
> bond0     Link encap:Ethernet  HWaddr 00:11:43:32:68:ab
>           inet6 addr: fe80::211:43ff:fe32:68ab/64 Scope:Link
>           UP BROADCAST RUNNING MASTER MULTICAST  MTU:1500  Metric:1
>           RX packets:360247 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:194789 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:139293160 (132.8 MiB)  TX bytes:28126921 (26.8 MiB)
>
> bond0.2   Link encap:Ethernet  HWaddr 00:11:43:32:68:ab
>           inet6 addr: fe80::211:43ff:fe32:68ab/64 Scope:Link
>           UP BROADCAST RUNNING PROMISC MASTER MULTICAST  MTU:1500  Metric:1
>           RX packets:187223 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:56357 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:115269968 (109.9 MiB)  TX bytes:9955227 (9.4 MiB)
>
> eth0      Link encap:Ethernet  HWaddr 00:11:43:32:68:ab
>           UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1
>           RX packets:155494 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:114980 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:1000
>           RX bytes:69486941 (66.2 MiB)  TX bytes:16889868 (16.1 MiB)
>           Interrupt:28
>
> eth1      Link encap:Ethernet  HWaddr 00:11:43:32:68:ab
>           UP BROADCAST RUNNING SLAVE MULTICAST  MTU:1500  Metric:1
>           RX packets:204753 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:79809 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:1000
>           RX bytes:69806219 (66.5 MiB)  TX bytes:11237053 (10.7 MiB)
>           Interrupt:29
>
> lo        Link encap:Local Loopback
>           inet addr:127.0.0.1  Mask:255.0.0.0
>           inet6 addr: ::1/128 Scope:Host
>           UP LOOPBACK RUNNING  MTU:16436  Metric:1
>           RX packets:8 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:8 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:560 (560.0 B)  TX bytes:560 (560.0 B)
>
> venet0    Link encap:UNSPEC  HWaddr
> 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
>           UP BROADCAST POINTOPOINT RUNNING NOARP  MTU:1500  Metric:1
>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>
> veth2070.2 Link encap:Ethernet  HWaddr 00:0c:29:cf:51:9f
>           inet6 addr: fe80::20c:29ff:fecf:519f/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:36810 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:151735 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:3099693 (2.9 MiB)  TX bytes:106816981 (101.8 MiB)
>
> vlan2     Link encap:Ethernet  HWaddr 00:0c:29:cf:51:9f
>           inet addr:10.107.208.131  Bcast:10.107.208.255
>  Mask:255.255.255.0
>           inet6 addr: 2001:470:e067:2:20c:29ff:fecf:519f/64 Scope:Global
>           inet6 addr: 2001:470:e067:2:211:43ff:fe32:68ab/64 Scope:Global
>           inet6 addr: fe80::211:43ff:fe32:68ab/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:127087 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:18801 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:39821589 (37.9 MiB)  TX bytes:5847464 (5.5 MiB)
>
> dell2650-01:~/media# brctl show
> bridge name     bridge id               STP enabled     interfaces
> vlan2           8000.000c29cf519f       no              bond0.2
>                                                         veth2070.2
>
>
> All is working for the most part with this arrangement except for a few
> issues:
>
> 1. There are some issues when I attempt to bring down the networking
> service where there are some network interfaces left hanging around that I
> expect should not be left hanging around.  Below is the output of stopping
> the networking (/etc/init.d/networking stop) and the interfaces that are
> left hanging around:
>
> Deconfiguring network interfaces...There is already a pid file
> /var/run/dhclient.vlan2.pid with pid 18891
> killed old client process, removed PID file
> Internet Systems Consortium DHCP Client V3.1.1
> Copyright 2004-2008 Internet Systems Consortium.
> All rights reserved.
> For info, please visit http://www.isc.org/sw/dhcp/
>
> Listening on LPF/vlan2/00:00:00:00:00:00
> Sending on   LPF/vlan2/00:00:00:00:00:00
> Sending on   Socket/fallback
> DHCPRELEASE on vlan2 to 10.107.208.1 port 67
> send_packet: Network is unreachable
> send_packet: please consult README file regarding broadcast address.
> SIOCSIFFLAGS: Cannot assign requested address
> done.
>
> # ifconfig -a
>
> bond0     Link encap:Ethernet  HWaddr 00:00:00:00:00:00
>           BROADCAST MASTER MULTICAST  MTU:1500  Metric:1
>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>
> bond0.2   Link encap:Ethernet  HWaddr 00:11:43:32:68:ab
>           BROADCAST PROMISC MASTER MULTICAST  MTU:1500  Metric:1
>           RX packets:187644 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:56466 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:115389061 (110.0 MiB)  TX bytes:9975413 (9.5 MiB)
>
> eth0      Link encap:Ethernet  HWaddr 00:11:43:32:68:ab
>           BROADCAST MULTICAST  MTU:1500  Metric:1
>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:1000
>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>           Interrupt:28
>
> eth1      Link encap:Ethernet  HWaddr 00:11:43:32:68:ac
>           BROADCAST MULTICAST  MTU:1500  Metric:1
>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:1000
>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>           Interrupt:29
>
> lo        Link encap:Local Loopback
>           inet addr:127.0.0.1  Mask:255.0.0.0
>           inet6 addr: ::1/128 Scope:Host
>           UP LOOPBACK RUNNING  MTU:16436  Metric:1
>           RX packets:8 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:8 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:560 (560.0 B)  TX bytes:560 (560.0 B)
>
> venet0    Link encap:UNSPEC  HWaddr
> 00-00-00-00-00-00-00-00-00-00-00-00-00-00-00-00
>           UP BROADCAST POINTOPOINT RUNNING NOARP  MTU:1500  Metric:1
>           RX packets:0 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)
>
> veth2070.2 Link encap:Ethernet  HWaddr 00:0c:29:cf:51:9f
>           inet6 addr: fe80::20c:29ff:fecf:519f/64 Scope:Link
>           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1
>           RX packets:36810 errors:0 dropped:0 overruns:0 frame:0
>           TX packets:151883 errors:0 dropped:0 overruns:0 carrier:0
>           collisions:0 txqueuelen:0
>           RX bytes:3099693 (2.9 MiB)  TX bytes:106868121 (101.9 MiB)
>
>
> 2. The second issue is a flurry of messages when networking is started
> (/etc/init.d/networking start):
>
> dell2650-01:~# cat networing_start.txt
> Configuring network interfaces...if-up.d/mountnfs[eth0]: waiting for
> interface eth1 before doing NFS mounts (warning).
> if-up.d/mountnfs[eth0]: waiting for interface bond0 before doing NFS mounts
> (warning).
> if-up.d/mountnfs[eth0]: waiting for interface bond0.2 before doing NFS
> mounts (warning).
> if-up.d/mountnfs[eth0]: waiting for interface vlan2 before doing NFS mounts
> (warning).
> if-up.d/mountnfs[eth1]: waiting for interface bond0 before doing NFS mounts
> (warning).
> if-up.d/mountnfs[eth1]: waiting for interface bond0.2 before doing NFS
> mounts (warning).
> if-up.d/mountnfs[eth1]: waiting for interface vlan2 before doing NFS mounts
> (warning).
> if-up.d/mountnfs[bond0]: waiting for interface bond0.2 before doing NFS
> mounts (warning).
> if-up.d/mountnfs[bond0]: waiting for interface vlan2 before doing NFS
> mounts (warning).
> ERROR: trying to add VLAN #2 to IF -:bond0:-  error: File exists
> Failed to bring up bond0.2.
> Set name-type for VLAN subsystem. Should be visible in
> /proc/net/vlan/config
> Internet Systems Consortium DHCP Client V3.1.1
> Copyright 2004-2008 Internet Systems Consortium.
> All rights reserved.
> For info, please visit http://www.isc.org/sw/dhcp/
>
> Listening on LPF/vlan2/00:11:43:32:68:ab
> Sending on   LPF/vlan2/00:11:43:32:68:ab
> Sending on   Socket/fallback
> DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 5
> DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 11
> DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 15
> DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 21
> DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 9
> DHCPOFFER from 10.107.208.1
> DHCPREQUEST on vlan2 to 255.255.255.255 port 67
> DHCPACK from 10.107.208.1
> bound to 10.107.208.131 -- renewal in 21524 seconds.
> if-up.d/mountnfs[vlan2]: waiting for interface bond0.2 before doing NFS
> mounts (warning).
> done.
>
>
> 3. The third issue are the IPv6 addresses that are assigned to some
> interfaces.  I expect ipv6 addresses on 'vlan2' and 'lo', but not any of the
> other interfaces.  I'm no kind of IPv6 expert, but what is the need for
> addresses on these interfaces when most software doesn't even know how to
> talk to them?
>
> Any help getting /etc/network/interfaces set up properly is greatly
> appreciated.  It was a headache getting it this far, but it is working, as
> far as sending/receiving packets and stopping/starting/restarting networking
> and being able to send packets, but it's sloppy.
>
> The idea behind the network configuration is to be able to create openvz
> VPS's and add veth interfaces to those hosts (multiple ips, broadcasts,
> etc.).  The network the server is on has several subnets and I would like to
> be able to connect different VPS's to different networks, depending on its
> needs.  This is done by bridging the veth interface (which feeds traffic to
> the VPS) to an interface that is bound to a single VLAN.  I do not want VPSs
> to connect to untagged interfaces as this would allow a VPS to connect to
> whatever network it wants to; I instead want that controlled by the VPS
> configuration on the physical host (CT0).
>
> Thanks,
> Axton Grams
>
>

--000e0cd709647e7a1304839446e4
Content-Type: text/html; charset=ISO-8859-1
Content-Transfer-Encoding: quoted-printable

<font face=3D"courier new,monospace">No bites?</font><div><font face=3D"cou=
rier new,monospace"><br></font></div><div><font face=3D"courier new,monospa=
ce">Axton<br></font><br><div class=3D"gmail_quote">On Sun, Apr 4, 2010 at 5=
:35 PM, Axton <span dir=3D"ltr">&lt;<a href=3D"mailto:axton.grams@csmining.org=
">axton.grams@csmining.org</a>&gt;</span> wrote:<br>
<blockquote class=3D"gmail_quote" style=3D"margin:0 0 0 .8ex;border-left:1p=
x #ccc solid;padding-left:1ex;"><div>I am trying to set up the /etc/network=
/interfaces script properly so that all interfaces are started/stopped prop=
erly by /etc/init.d/networking. =A0I have this set up correctly, mostly, I =
think, but there is a flurry of warning messages on start of the /etc/init.=
d/networking.</div>

<div><br></div><div>First, some background information on the setup.</div><=
div><br></div><div>* Server is a Dell PowerEdge 2650 with 10gb physical mem=
ory (hence the i386 bigmem kernel)</div><div><br></div><div>* Running openv=
z kernel:</div>

<div><div>agrams@dell2650-01:~$ uname -a</div><div>Linux dell2650-01 2.6.26=
-2-openvz-686 #1 SMP Tue Mar 9 18:54:31 UTC 2010 i686 GNU/Linux</div><div><=
br></div></div><div>* Server has 2 nics:</div><div><div><div><div>agrams@de=
ll2650-01:~$ dmesg |egrep &#39;(eth0|eth1)&#39; |head -6</div>

<div>[ =A0 =A05.050804] eth0: Tigon3 [partno(BCM95703A30) rev 1002 PHY(5703=
)] (PCIX:133MHz:64-bit) 10/100/1000Base-T Ethernet 00:11:43:32:68:ab</div><=
div>[ =A0 =A05.050804] eth0: RXcsums[1] LinkChgREG[0] MIirq[0] ASF[0] WireS=
peed[1] TSOcap[1]</div>

<div>[ =A0 =A05.050804] eth0: dma_rwctrl[769c4000] dma_mask[64-bit]</div><d=
iv>[ =A0 =A05.110547] eth1: Tigon3 [partno(BCM95703A30) rev 1002 PHY(5703)]=
 (PCIX:133MHz:64-bit) 10/100/1000Base-T Ethernet 00:11:43:32:68:ac</div><di=
v>[ =A0 =A05.110553] eth1: RXcsums[1] LinkChgREG[0] MIirq[0] ASF[0] WireSpe=
ed[1] TSOcap[1]</div>

<div>[ =A0 =A05.110557] eth1: dma_rwctrl[769c4000] dma_mask[64-bit]</div><d=
iv><br></div></div><div><br></div><div>Now, on to the network configuration=
:</div><div><br></div><div>* Switch is a Dell PowerConnect 5324</div><div>
** Server is connected to ports 13 and 15</div>
<div>** Link aggregation group is 1 with ports 13 and 15</div><div><br></di=
v><div>Here is the configuration from the switch console:</div><div><br></d=
iv><div><div>dell5324# show interfaces status port-channel 1</div><div>

=A0=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0Flow =A0 =A0Link</div><div>Ch =A0 =A0 =A0 Type =A0 =A0Duplex =A0=
Speed =A0Neg =A0 =A0 =A0control =A0State</div><div>-------- ------- ------ =
=A0----- =A0-------- ------- =A0-----------</div><div>ch1 =A0 =A0 =A01G =A0=
 =A0 =A0Full =A0 =A01000 =A0 Enabled =A0Off =A0 =A0 =A0Up</div>

<div><br></div><div>dell5324# show interfaces switchport port-channel 1</di=
v><div>Port : ch1</div><div>Port Mode: General</div><div>Gvrp Status: disab=
led</div><div>Ingress Filtering: true</div><div>Acceptable Frame Type: admi=
tOnlyVlanTagged</div>

<div>Ingress UnTagged VLAN ( NATIVE ): 4095</div><div><br></div><div>Port i=
s member in:</div><div><br></div><div>Vlan =A0 =A0 =A0 =A0 =A0 =A0 =A0 Name=
 =A0 =A0 =A0 =A0 =A0 =A0 =A0 Egress rule Port Membership Type</div><div>---=
- -------------------------------- ----------- --------------------</div>

<div>=A02 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 LAN =A0 =A0 =A0 =A0 =A0 =A0 =A0 =
=A0 =A0Tagged =A0 =A0 =A0 =A0 =A0 Static</div><div>=A05 =A0 =A0 =A0 =A0 =A0=
 =A0 =A0 =A0 DMZ =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0Tagged =A0 =A0 =A0 =A0 =
=A0 Static</div><div><br></div><div>Forbidden VLANS:</div><div><br></div><d=
iv>Vlan =A0 =A0 =A0 =A0 =A0 =A0 =A0 Name</div>

<div>---- --------------------------------</div><div>=A03 =A0 =A0 =A0 =A0 =
=A0 =A0 =A0 =A0 INET</div><div><br></div><div>Classification rules:</div><d=
iv><br></div><div>Protocol based VLANs:</div><div><br></div><div>Group ID V=
lan ID</div><div>

-------- -------</div><div><br></div><div><div>dell5324# show interfaces po=
rt-channel 1</div><div><br></div><div>Load balancing: Layer 3.</div><div><b=
r></div><div>Channel =A0Ports</div><div>------- =A0-----</div><div>ch1 =A0 =
=A0 =A0Active: g(13,15)</div>

</div><div><br></div></div><div>* I am setting up these interfaces as 802.3=
ad bonded interface (bond mode=3D4):</div><div><div>agrams@dell2650-01:~$ c=
at /proc/net/bonding/bond0</div><div>Ethernet Channel Bonding Driver: v3.2.=
5 (March 21, 2008)</div>

<div><br></div><div>Bonding Mode: IEEE 802.3ad Dynamic link aggregation</di=
v><div>Transmit Hash Policy: layer3+4 (1)</div><div>MII Status: up</div><di=
v>MII Polling Interval (ms): 100</div><div>Up Delay (ms): 200</div><div>

Down Delay (ms): 200</div><div><br></div><div>802.3ad info</div><div>LACP r=
ate: fast</div><div>Active Aggregator Info:</div><div>=A0=A0 =A0 =A0 =A0Agg=
regator ID: 10</div><div>=A0=A0 =A0 =A0 =A0Number of ports: 2</div><div>=A0=
=A0 =A0 =A0 =A0Actor Key: 17</div>

<div>=A0=A0 =A0 =A0 =A0Partner Key: 25</div><div>=A0=A0 =A0 =A0 =A0Partner =
Mac Address: 00:18:8b:97:47:00</div><div><br></div><div>Slave Interface: et=
h0</div><div>MII Status: up</div><div>Link Failure Count: 0</div><div>Perma=
nent HW addr: 00:11:43:32:68:ab</div>

<div>Aggregator ID: 10</div><div><br></div><div>Slave Interface: eth1</div>=
<div>MII Status: up</div><div>Link Failure Count: 0</div><div>Permanent HW =
addr: 00:11:43:32:68:ac</div><div>Aggregator ID: 10</div><div><br></div>

<div>* On the Debian host, the following configuration in in place:</div><d=
iv><div>agrams@dell2650-01:~$ cat /etc/network/interfaces</div><div># This =
file describes the network interfaces available on your system</div><div>

# and how to activate them. For more information, see interfaces(5).</div><=
div><br></div><div># The loopback network interface</div><div>auto lo</div>=
<div>iface lo inet loopback</div><div><br></div><div># Physical interface 1=
</div>

<div>auto eth0</div><div>iface eth0 inet manual</div><div><br></div><div># =
Physical interface 2</div><div>auto eth1</div><div>iface eth1 inet manual</=
div><div><br></div><div># lacp bond interface</div><div>auto bond0</div>

<div>iface bond0 inet manual</div><div>=A0=A0 =A0 =A0 =A0up ifconfig bond0 =
0.0.0.0 up</div><div>=A0=A0 =A0 =A0 =A0slaves eth0 eth1</div><div><br></div=
><div># vlan2 bond interface</div><div>auto bond0.2</div><div>iface bond0.2=
 inet manual</div>

<div>=A0=A0 =A0 =A0 =A0up ifconfig bond0.2 0.0.0.0 up</div><div>=A0=A0 =A0 =
=A0 =A0pre-up /sbin/vconfig add bond0 2</div><div><br></div><div># bridge t=
o vlan2 bond interface</div><div>auto vlan2</div><div>iface vlan2 inet dhcp=
</div><div>=A0=A0 =A0 =A0 =A0pre-up /usr/sbin/brctl addbr vlan2</div>

<div>=A0=A0 =A0 =A0 =A0pre-up /usr/sbin/brctl addif vlan2 bond0.2</div><div=
>=A0=A0 =A0 =A0 =A0pre-down /sbin/ifconfig vlan2 down</div><div>=A0=A0 =A0 =
=A0 =A0down /usr/sbin/brctl delif vlan2 bond0.2</div><div>=A0=A0 =A0 =A0 =
=A0post-down /usr/sbin/brctl delbr vlan2</div>

<div><br></div><div>Which yields the following configuration information fr=
om the host:</div><div><br></div><div><div>dell2650-01:~/media# cat /proc/n=
et/bonding/bond0</div><div>Ethernet Channel Bonding Driver: v3.2.5 (March 2=
1, 2008)</div>

<div><br></div><div>Bonding Mode: IEEE 802.3ad Dynamic link aggregation</di=
v><div>Transmit Hash Policy: layer3+4 (1)</div><div>MII Status: up</div><di=
v>MII Polling Interval (ms): 100</div><div>Up Delay (ms): 200</div><div>

Down Delay (ms): 200</div><div><br></div><div>802.3ad info</div><div>LACP r=
ate: fast</div><div>Active Aggregator Info:</div><div>=A0=A0 =A0 =A0 =A0Agg=
regator ID: 10</div><div>=A0=A0 =A0 =A0 =A0Number of ports: 2</div><div>=A0=
=A0 =A0 =A0 =A0Actor Key: 17</div>

<div>=A0=A0 =A0 =A0 =A0Partner Key: 25</div><div>=A0=A0 =A0 =A0 =A0Partner =
Mac Address: 00:18:8b:97:47:00</div><div><br></div><div>Slave Interface: et=
h0</div><div>MII Status: up</div><div>Link Failure Count: 0</div><div>Perma=
nent HW addr: 00:11:43:32:68:ab</div>

<div>Aggregator ID: 10</div><div><br></div><div>Slave Interface: eth1</div>=
<div>MII Status: up</div><div>Link Failure Count: 0</div><div>Permanent HW =
addr: 00:11:43:32:68:ac</div><div>Aggregator ID: 10</div><div><br></div>

<div><div>dell2650-01:~# cat /proc/net/vlan/config</div><div>VLAN Dev name =
=A0 =A0| VLAN ID</div><div>Name-Type: VLAN_NAME_TYPE_PLUS_VID_NO_PAD</div><=
div>bond0.2 =A0 =A0 =A0 =A0| 2 =A0| bond0</div><div><br></div><div><div>del=
l2650-01:~# cat /proc/net/vlan/bond0.2</div>

<div>bond0.2 =A0VID: 2 =A0REORDER_HDR: 1 =A0dev-&gt;priv_flags: 1</div><div=
>=A0=A0 =A0 =A0 =A0 total frames received =A0 =A0 =A0 189418</div><div>=A0=
=A0 =A0 =A0 =A0 =A0total bytes received =A0 =A0115871948</div><div>=A0=A0 =
=A0 =A0Broadcast/Multicast Rcvd =A0 =A0 =A0 114195</div>

<div><br></div><div>=A0=A0 =A0 =A0total frames transmitted =A0 =A0 =A0 =A05=
6900</div><div>=A0=A0 =A0 =A0 total bytes transmitted =A0 =A0 10038649</div=
><div>=A0=A0 =A0 =A0 =A0 =A0 =A0total headroom inc =A0 =A0 =A0 =A0 =A0 =A00=
</div><div>=A0=A0 =A0 =A0 =A0 =A0 total encap on xmit =A0 =A0 =A0 =A0 =A0 =
=A00</div>

<div>Device: bond0</div><div>INGRESS priority mappings: 0:0 =A01:0 =A02:0 =
=A03:0 =A04:0 =A05:0 =A06:0 7:0</div><div>EGRESSS priority Mappings:</div><=
div><br></div></div></div><div><div>dell2650-01:~/media# ifconfig -a</div><=
div>bond0 =A0 =A0 Link encap:Ethernet =A0HWaddr 00:11:43:32:68:ab</div>

<div>=A0=A0 =A0 =A0 =A0 =A0inet6 addr: fe80::211:43ff:fe32:68ab/64 Scope:Li=
nk</div><div>=A0=A0 =A0 =A0 =A0 =A0UP BROADCAST RUNNING MASTER MULTICAST =
=A0MTU:1500 =A0Metric:1</div><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:360247 e=
rrors:0 dropped:0 overruns:0 frame:0</div>

<div>=A0=A0 =A0 =A0 =A0 =A0TX packets:194789 errors:0 dropped:0 overruns:0 =
carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div><d=
iv>=A0=A0 =A0 =A0 =A0 =A0RX bytes:139293160 (132.8 MiB) =A0TX bytes:2812692=
1 (26.8 MiB)</div><div><br></div>
<div>
bond0.2 =A0 Link encap:Ethernet =A0HWaddr 00:11:43:32:68:ab</div><div>=A0=
=A0 =A0 =A0 =A0 =A0inet6 addr: fe80::211:43ff:fe32:68ab/64 Scope:Link</div>=
<div>=A0=A0 =A0 =A0 =A0 =A0UP BROADCAST RUNNING PROMISC MASTER MULTICAST =
=A0MTU:1500 =A0Metric:1</div><div>

=A0=A0 =A0 =A0 =A0 =A0RX packets:187223 errors:0 dropped:0 overruns:0 frame=
:0</div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:56357 errors:0 dropped:0 over=
runs:0 carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0<=
/div><div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:115269968 (109.9 MiB) =A0TX bytes:=
9955227 (9.4 MiB)</div>

<div><br></div><div>eth0 =A0 =A0 =A0Link encap:Ethernet =A0HWaddr 00:11:43:=
32:68:ab</div><div>=A0=A0 =A0 =A0 =A0 =A0UP BROADCAST RUNNING SLAVE MULTICA=
ST =A0MTU:1500 =A0Metric:1</div><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:15549=
4 errors:0 dropped:0 overruns:0 frame:0</div>

<div>=A0=A0 =A0 =A0 =A0 =A0TX packets:114980 errors:0 dropped:0 overruns:0 =
carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:1000</div=
><div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:69486941 (66.2 MiB) =A0TX bytes:168898=
68 (16.1 MiB)</div><div>=A0=A0 =A0 =A0 =A0 =A0Interrupt:28</div>

<div><br></div><div>eth1 =A0 =A0 =A0Link encap:Ethernet =A0HWaddr 00:11:43:=
32:68:ab</div><div>=A0=A0 =A0 =A0 =A0 =A0UP BROADCAST RUNNING SLAVE MULTICA=
ST =A0MTU:1500 =A0Metric:1</div><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:20475=
3 errors:0 dropped:0 overruns:0 frame:0</div>

<div>=A0=A0 =A0 =A0 =A0 =A0TX packets:79809 errors:0 dropped:0 overruns:0 c=
arrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:1000</div>=
<div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:69806219 (66.5 MiB) =A0TX bytes:1123705=
3 (10.7 MiB)</div><div>=A0=A0 =A0 =A0 =A0 =A0Interrupt:29</div>

<div><br></div><div>lo =A0 =A0 =A0 =A0Link encap:Local Loopback</div><div>=
=A0=A0 =A0 =A0 =A0 =A0inet addr:127.0.0.1 =A0Mask:255.0.0.0</div><div>=A0=
=A0 =A0 =A0 =A0 =A0inet6 addr: ::1/128 Scope:Host</div><div>=A0=A0 =A0 =A0 =
=A0 =A0UP LOOPBACK RUNNING =A0MTU:16436 =A0Metric:1</div>

<div>=A0=A0 =A0 =A0 =A0 =A0RX packets:8 errors:0 dropped:0 overruns:0 frame=
:0</div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:8 errors:0 dropped:0 overruns=
:0 carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div=
><div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:560 (560.0 B) =A0TX bytes:560 (560.0 B=
)</div>

<div><br></div><div>venet0 =A0 =A0Link encap:UNSPEC =A0HWaddr 00-00-00-00-0=
0-00-00-00-00-00-00-00-00-00-00-00</div><div>=A0=A0 =A0 =A0 =A0 =A0UP BROAD=
CAST POINTOPOINT RUNNING NOARP =A0MTU:1500 =A0Metric:1</div><div>=A0=A0 =A0=
 =A0 =A0 =A0RX packets:0 errors:0 dropped:0 overruns:0 frame:0</div>

<div>=A0=A0 =A0 =A0 =A0 =A0TX packets:0 errors:0 dropped:0 overruns:0 carri=
er:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div><div>=
=A0=A0 =A0 =A0 =A0 =A0RX bytes:0 (0.0 B) =A0TX bytes:0 (0.0 B)</div><div><b=
r></div><div>veth2070.2 Link encap:Ethernet =A0HWaddr 00:0c:29:cf:51:9f</di=
v>

<div>=A0=A0 =A0 =A0 =A0 =A0inet6 addr: fe80::20c:29ff:fecf:519f/64 Scope:Li=
nk</div><div>=A0=A0 =A0 =A0 =A0 =A0UP BROADCAST RUNNING MULTICAST =A0MTU:15=
00 =A0Metric:1</div><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:36810 errors:0 dr=
opped:0 overruns:0 frame:0</div><div>

=A0=A0 =A0 =A0 =A0 =A0TX packets:151735 errors:0 dropped:0 overruns:0 carri=
er:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div><div>=
=A0=A0 =A0 =A0 =A0 =A0RX bytes:3099693 (2.9 MiB) =A0TX bytes:106816981 (101=
.8 MiB)</div><div><br></div><div>vlan2 =A0 =A0 Link encap:Ethernet =A0HWadd=
r 00:0c:29:cf:51:9f</div>

<div>=A0=A0 =A0 =A0 =A0 =A0inet addr:10.107.208.131 =A0Bcast:10.107.208.255=
 =A0Mask:255.255.255.0</div><div>=A0=A0 =A0 =A0 =A0 =A0inet6 addr: 2001:470=
:e067:2:20c:29ff:fecf:519f/64 Scope:Global</div><div>=A0=A0 =A0 =A0 =A0 =A0=
inet6 addr: 2001:470:e067:2:211:43ff:fe32:68ab/64 Scope:Global</div>

<div>=A0=A0 =A0 =A0 =A0 =A0inet6 addr: fe80::211:43ff:fe32:68ab/64 Scope:Li=
nk</div><div>=A0=A0 =A0 =A0 =A0 =A0UP BROADCAST RUNNING MULTICAST =A0MTU:15=
00 =A0Metric:1</div><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:127087 errors:0 d=
ropped:0 overruns:0 frame:0</div><div>

=A0=A0 =A0 =A0 =A0 =A0TX packets:18801 errors:0 dropped:0 overruns:0 carrie=
r:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div><div>=A0=
=A0 =A0 =A0 =A0 =A0RX bytes:39821589 (37.9 MiB) =A0TX bytes:5847464 (5.5 Mi=
B)</div><div><br></div><div><div>
dell2650-01:~/media# brctl show</div>
<div>bridge name =A0 =A0 bridge id =A0 =A0 =A0 =A0 =A0 =A0 =A0 STP enabled =
=A0 =A0 interfaces</div><div>vlan2 =A0 =A0 =A0 =A0 =A0 8000.000c29cf519f =
=A0 =A0 =A0 no =A0 =A0 =A0 =A0 =A0 =A0 =A0bond0.2</div><div>=A0=A0 =A0 =A0 =
=A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0 =A0=
 =A0 =A0 =A0 =A0 =A0 =A0veth2070.2</div>

<div><br></div><div><br></div><div>All is working for the most part with th=
is arrangement except for a few issues:</div><div><br></div><div>1. There a=
re some issues when I attempt to bring down the networking service where th=
ere are some network interfaces left hanging around that I expect should no=
t be left hanging around. =A0Below is the output of stopping the networking=
 (/etc/init.d/networking stop) and the interfaces that are left hanging aro=
und:</div>

<div><br></div><div><div>Deconfiguring network interfaces...There is alread=
y a pid file /var/run/dhclient.vlan2.pid with pid 18891</div><div>killed ol=
d client process, removed PID file</div><div>Internet Systems Consortium DH=
CP Client V3.1.1</div>

<div>Copyright 2004-2008 Internet Systems Consortium.</div><div>All rights =
reserved.</div><div>For info, please visit <a href=3D"http://www.isc.org/sw=
/dhcp/" target=3D"_blank">http://www.isc.org/sw/dhcp/</a></div><div><br></d=
iv>
<div>Listening on LPF/vlan2/00:00:00:00:00:00</div>
<div>Sending on =A0 LPF/vlan2/00:00:00:00:00:00</div><div>Sending on =A0 So=
cket/fallback</div><div>DHCPRELEASE on vlan2 to 10.107.208.1 port 67</div><=
div>send_packet: Network is unreachable</div><div>send_packet: please consu=
lt README file regarding broadcast address.</div>

<div>SIOCSIFFLAGS: Cannot assign requested address</div><div>done.</div><di=
v><br></div><div># ifconfig -a</div><div><br></div><div>bond0 =A0 =A0 Link =
encap:Ethernet =A0HWaddr 00:00:00:00:00:00</div><div>=A0=A0 =A0 =A0 =A0 =A0=
BROADCAST MASTER MULTICAST =A0MTU:1500 =A0Metric:1</div>

<div>=A0=A0 =A0 =A0 =A0 =A0RX packets:0 errors:0 dropped:0 overruns:0 frame=
:0</div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:0 errors:0 dropped:0 overruns=
:0 carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div=
><div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:0 (0.0 B) =A0TX bytes:0 (0.0 B)</div>

<div><br></div><div>bond0.2 =A0 Link encap:Ethernet =A0HWaddr 00:11:43:32:6=
8:ab</div><div>=A0=A0 =A0 =A0 =A0 =A0BROADCAST PROMISC MASTER MULTICAST =A0=
MTU:1500 =A0Metric:1</div><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:187644 erro=
rs:0 dropped:0 overruns:0 frame:0</div>

<div>=A0=A0 =A0 =A0 =A0 =A0TX packets:56466 errors:0 dropped:0 overruns:0 c=
arrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div><di=
v>=A0=A0 =A0 =A0 =A0 =A0RX bytes:115389061 (110.0 MiB) =A0TX bytes:9975413 =
(9.5 MiB)</div><div><br></div><div>

eth0 =A0 =A0 =A0Link encap:Ethernet =A0HWaddr 00:11:43:32:68:ab</div><div>=
=A0=A0 =A0 =A0 =A0 =A0BROADCAST MULTICAST =A0MTU:1500 =A0Metric:1</div><div=
>=A0=A0 =A0 =A0 =A0 =A0RX packets:0 errors:0 dropped:0 overruns:0 frame:0</=
div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:0 errors:0 dropped:0 overruns:0 c=
arrier:0</div>

<div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:1000</div><div>=A0=A0 =
=A0 =A0 =A0 =A0RX bytes:0 (0.0 B) =A0TX bytes:0 (0.0 B)</div><div>=A0=A0 =
=A0 =A0 =A0 =A0Interrupt:28</div><div><br></div><div>eth1 =A0 =A0 =A0Link e=
ncap:Ethernet =A0HWaddr 00:11:43:32:68:ac</div>

<div>=A0=A0 =A0 =A0 =A0 =A0BROADCAST MULTICAST =A0MTU:1500 =A0Metric:1</div=
><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:0 errors:0 dropped:0 overruns:0 fram=
e:0</div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:0 errors:0 dropped:0 overrun=
s:0 carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:1000<=
/div>

<div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:0 (0.0 B) =A0TX bytes:0 (0.0 B)</div><d=
iv>=A0=A0 =A0 =A0 =A0 =A0Interrupt:29</div><div><br></div><div>lo =A0 =A0 =
=A0 =A0Link encap:Local Loopback</div><div>=A0=A0 =A0 =A0 =A0 =A0inet addr:=
127.0.0.1 =A0Mask:255.0.0.0</div><div>=A0=A0 =A0 =A0 =A0 =A0inet6 addr: ::1=
/128 Scope:Host</div>

<div>=A0=A0 =A0 =A0 =A0 =A0UP LOOPBACK RUNNING =A0MTU:16436 =A0Metric:1</di=
v><div>=A0=A0 =A0 =A0 =A0 =A0RX packets:8 errors:0 dropped:0 overruns:0 fra=
me:0</div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:8 errors:0 dropped:0 overru=
ns:0 carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</d=
iv>

<div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:560 (560.0 B) =A0TX bytes:560 (560.0 B)=
</div><div><br></div><div>venet0 =A0 =A0Link encap:UNSPEC =A0HWaddr 00-00-0=
0-00-00-00-00-00-00-00-00-00-00-00-00-00</div><div>=A0=A0 =A0 =A0 =A0 =A0UP=
 BROADCAST POINTOPOINT RUNNING NOARP =A0MTU:1500 =A0Metric:1</div>

<div>=A0=A0 =A0 =A0 =A0 =A0RX packets:0 errors:0 dropped:0 overruns:0 frame=
:0</div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:0 errors:0 dropped:0 overruns=
:0 carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuelen:0</div=
><div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:0 (0.0 B) =A0TX bytes:0 (0.0 B)</div>

<div><br></div><div>veth2070.2 Link encap:Ethernet =A0HWaddr 00:0c:29:cf:51=
:9f</div><div>=A0=A0 =A0 =A0 =A0 =A0inet6 addr: fe80::20c:29ff:fecf:519f/64=
 Scope:Link</div><div>=A0=A0 =A0 =A0 =A0 =A0UP BROADCAST RUNNING MULTICAST =
=A0MTU:1500 =A0Metric:1</div>

<div>=A0=A0 =A0 =A0 =A0 =A0RX packets:36810 errors:0 dropped:0 overruns:0 f=
rame:0</div><div>=A0=A0 =A0 =A0 =A0 =A0TX packets:151883 errors:0 dropped:0=
 overruns:0 carrier:0</div><div>=A0=A0 =A0 =A0 =A0 =A0collisions:0 txqueuel=
en:0</div><div>=A0=A0 =A0 =A0 =A0 =A0RX bytes:3099693 (2.9 MiB) =A0TX bytes=
:106868121 (101.9 MiB)</div>

<div><br></div></div><div><br></div><div>2. The second issue is a flurry of=
 messages when networking is started (/etc/init.d/networking start):</div><=
div><br></div><div><div>dell2650-01:~# cat networing_start.txt</div><div>

Configuring network interfaces...if-up.d/mountnfs[eth0]: waiting for interf=
ace eth1 before doing NFS mounts (warning).</div><div>if-up.d/mountnfs[eth0=
]: waiting for interface bond0 before doing NFS mounts (warning).</div>

<div>if-up.d/mountnfs[eth0]: waiting for interface bond0.2 before doing NFS=
 mounts (warning).</div><div>if-up.d/mountnfs[eth0]: waiting for interface =
vlan2 before doing NFS mounts (warning).</div><div>if-up.d/mountnfs[eth1]: =
waiting for interface bond0 before doing NFS mounts (warning).</div>

<div>if-up.d/mountnfs[eth1]: waiting for interface bond0.2 before doing NFS=
 mounts (warning).</div><div>if-up.d/mountnfs[eth1]: waiting for interface =
vlan2 before doing NFS mounts (warning).</div><div>if-up.d/mountnfs[bond0]:=
 waiting for interface bond0.2 before doing NFS mounts (warning).</div>

<div>if-up.d/mountnfs[bond0]: waiting for interface vlan2 before doing NFS =
mounts (warning).</div><div>ERROR: trying to add VLAN #2 to IF -:bond0:- =
=A0error: File exists</div><div>Failed to bring up bond0.2.</div><div>Set n=
ame-type for VLAN subsystem. Should be visible in /proc/net/vlan/config</di=
v>

<div>Internet Systems Consortium DHCP Client V3.1.1</div><div>Copyright 200=
4-2008 Internet Systems Consortium.</div><div>All rights reserved.</div><di=
v>For info, please visit <a href=3D"http://www.isc.org/sw/dhcp/" target=3D"=
_blank">http://www.isc.org/sw/dhcp/</a></div>

<div><br></div><div>Listening on LPF/vlan2/00:11:43:32:68:ab</div><div>Send=
ing on =A0 LPF/vlan2/00:11:43:32:68:ab</div><div>Sending on =A0 Socket/fall=
back</div><div>DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 5<=
/div>

<div>DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 11</div><div=
>DHCPDISCOVER on vlan2 to 255.255.255.255 port 67 interval 15</div><div>DHC=
PDISCOVER on vlan2 to 255.255.255.255 port 67 interval 21</div><div>DHCPDIS=
COVER on vlan2 to 255.255.255.255 port 67 interval 9</div>

<div>DHCPOFFER from 10.107.208.1</div><div>DHCPREQUEST on vlan2 to 255.255.=
255.255 port 67</div><div>DHCPACK from 10.107.208.1</div><div>bound to 10.1=
07.208.131 -- renewal in 21524 seconds.</div><div>if-up.d/mountnfs[vlan2]: =
waiting for interface bond0.2 before doing NFS mounts (warning).</div>

<div>done.</div><div><br></div><div><br></div><div>3. The third issue are t=
he IPv6 addresses that are assigned to some interfaces. =A0I expect ipv6 ad=
dresses on &#39;vlan2&#39; and &#39;lo&#39;, but not any of the other inter=
faces. =A0I&#39;m no kind of IPv6 expert, but what is the need for addresse=
s on these interfaces when most software doesn&#39;t even know how to talk =
to them?</div>

<div><br></div><div>Any help getting /etc/network/interfaces set up properl=
y is greatly appreciated. =A0It was a headache getting it this far, but it =
is working, as far as sending/receiving packets and stopping/starting/resta=
rting networking and being able to send packets, but it&#39;s sloppy.</div>

<div><br></div><div>The idea behind the network configuration is to be able=
 to create openvz VPS&#39;s and add veth interfaces to those hosts (multipl=
e ips, broadcasts, etc.). =A0The network the server is on has several subne=
ts and I would like to be able to connect different VPS&#39;s to different =
networks, depending on its needs. =A0This is done by bridging the veth inte=
rface (which feeds traffic to the VPS) to an interface that is bound to a s=
ingle VLAN. =A0I do not want VPSs to connect to untagged interfaces as this=
 would allow a VPS to connect to whatever network it wants to; I instead wa=
nt that controlled by the VPS configuration on the physical host (CT0).</di=
v>

<div><br></div><div>Thanks,</div><div>Axton Grams</div></div></div></div></=
div></div><div><br></div></div></div></div>
</blockquote></div><br></div>

--000e0cd709647e7a1304839446e4--


-- 
To UNSUBSCRIBE, email to debian-user-REQUEST@lists.debian.org 
with a subject of "unsubscribe". Trouble? Contact listmaster@lists.debian.org
Archive: http://lists.debian.org/z2qf5c17fbb1004060952td1afc498ud1b9a402a955d1be@mail.csmining.org


